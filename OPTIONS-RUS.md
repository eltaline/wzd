<img src="/images/logo.png" alt="wZD Logo"/>

Параметры wZD:
========

Секция [command line]
------------

- -config string
        --config=/etc/wzd/wzd.conf (по умолчанию "/etc/wzd/wzd.conf")
- -debug 
        --debug - режим отладки
- -help 
        --help - выводит помощь
- -version 
        --version - выводит версию

Секция [global]
------------

bindaddr
- **Описание:** основной адрес и TCP порт, значение ":9699" все адреса
- **Умолчание:** "127.0.0.1:9699"
- **Тип:** string
- **Секция:** [global]

readtimeout
- **Описание:** задает таймаут на максимальное время передачи данных от клиента серверу. Для передачи больших файлов следует увеличить. Если wZD сервер установлен за nginx/haproxy, тогда можно не использовать данный таймаут установив его в 0. не настраивается для виртуального хоста
- **Умолчание:** 60
- **Значения:** 0-86400
- **Тип:** int
- **Секция:** [global]

readheadertimeout
- **Описание:** задает таймаут на максимальное время получения заголовков от клиента. Если wZD сервер установлен за nginx/haproxy, тогда можно не использовать данный таймаут установив его в 0. Если параметр = 0, тогда берется значение параметра readtimeout, если и readtimeout = 0, тогда readheadertimeout таймаут не используется (без таймаута). не настраивается для виртуального хоста
- **Умолчание:** 5
- **Значения:** 0-86400
- **Тип:** int
- **Секция:** [global]

idletimeout
- **Описание:** задает таймаут на максимальное время жизни keep alive соединений. Если параметр = 0, тогда берется значение параметра readtimeout, если и readtimeout = 0, тогда idletimeout таймаут не используется (без таймаута). не настраивается для виртуального хоста
- **Умолчание:** 60
- **Значения:** 0-86400
- **Тип:** int
- **Секция:** [global]

writetimeout
- **Описание:** задает таймаут на максимальное время передачи данных клиенту. Для передачи больших файлов следует значительно увеличить. Если wZD сервер установлен за nginx/haproxy, тогда можно не использовать данный таймаут установив его в 0 (без таймаута). не настраивается для виртуального хоста
- **Умолчание:** 60
- **Значения:** 0-86400
- **Тип:** int
- **Секция:** [global]

realheader
- **Описание:** заголовок реального IP адреса от реверс прокси, не настраивается для виртуального хоста
- **Умолчание:** "X-Real-IP"
- **Тип:** string
- **Секция:** [global]
       
charset
- **Описание:** кодировка на весь сервер, не настраивается для виртуального хоста
- **Умолчание:** "UTF-8"
- **Тип:** string
- **Секция:** [global]

debugmode
- **Описание:** режим отладки
- **Умолчание:** false
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [global]

pidfile
- **Описание:** путь к pid файлу
- **Умолчание:** "/run/wzd/wzd.pid"
- **Тип:** string
- **Секция:** [global]

logdir
- **Описание:** путь к log директории
- **Умолчание:** "/var/log/wzd"
- **Тип:** string
- **Секция:** [global]

logmode
- **Описание:** права на log файлы (маска)
- **Умолчание:** 0640
- **Значения:** 0600-0666
- **Тип:** uint32
- **Секция:** [global]

defsleep
- **Описание:** sleep между попытками открытия bolt архивов/sql соединений (секунды)
- **Умолчание:** 1
- **Значения:** 1-5
- **Тип:** int
- **Секция:** [global]

cmpsched = true
- **Описание:** глобальное включение/отключение автоматического диспетчера компакции bolt архивов 
- **Умолчание:** false
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [global]

cmpdir
- **Описание:** директория технической базы данных. Технических данных мало, если не перезаписывать/удалять десятки миллионов файлов в Bolt архивах при включенном диспетчере компакции
- **Умолчание:** /var/lib/wzd
- **Тип:** string
- **Секция:** [global]

cmptime = 30 
- **Описание:** время ожидания компакции обновленных bolt архивов (дни), в случае если в технической sql базе будет сервер, для которого не определился machid идентификатор, то это динамически случайно увеличивается на время каждой итерации запуска диспетчера компации не более чем в 3 раза (дни). Сделано для предотвращения параллельной компакции одних и тех дже bolt архивов разными wZD серверами, если несколько серверов не имеют machid идентификатор и при этом используется центральная SQL база между всеми серверами wZD (дни)
- **Умолчание:** 30
- **Значения:** 1-1000
- **Тип:** int
- **Секция:** [global]

cmpcheck = 5
- **Описание:** интервал запуска автоматического диспетчера компакции (секунды)
- **Умолчание:** 5
- **Значения:** 1-5
- **Тип:** int
- **Секция:** [global]

Секция [server] и подсекции [server.name]
------------

[server.name]
- **Описание:** основной внутренний идентификатор виртуального хоста. после "." можно использовать любое имя, это не доменное имя, только внутренний идентификатор
- **Тип:** string
- **Секция:** [server]

host
- **Описание:** имя виртуального хоста. Не поддерживается * или _ , для сведения множества виртуальных хостов на 1 виртуальный хост в wZD сервере используйте nginx/haproxy или любой другой реверс прокси сервер с жестко заданным proxy_set_header Host hostname; (на примере nginx), где hostname = host в виртуальном хосте wZD сервера
- **Умолчание:** обязательный параметр
- **Тип:** string
- **Секция:** [server.name]

root
- **Описание:** корневая директория виртуального хоста
- **Умолчание:** обязательный параметр
- **Тип:** string
- **Секция:** [server.name]

upload
- **Описание:** включает/отключает метод PUT для виртуального хоста
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

delete
- **Описание:** включает/отключает метод DELETE для виртуального хоста
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

compaction
- **Описание:** включает/отключает автоматическое добавление задач для диспетчера компакции bolt архивов, при обновлении/удалении файлов/значений в bolt архивах, если cmpsched не отключен глобально
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

writeintegrity
- **Описание:** включает/отключает подсчет и запись контрольной суммы в бинарный заголовок во время загрузки файлов/значений через wZD сервер в bolt архивы. Рекомендуется включить.
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

readintegrity
- **Описание:** включает/отключает проверку контрольной суммы из бинарного заголовка во время выдачи файлов/значений клиенту сервера. Рекомендуется включить
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

trytimes
- **Описание:** количество попыток получения виртуальной блокировки bolt архива, прежде чем выдать http ошибку (количество)
- **Умолчание:** обязательный параметр
- **Значения:** 1-1000
- **Тип:** int
- **Секция:** [server.name]

fmaxsize
- **Описание:** максимальный размер загружаемого файла/значения в bolt архив. Если данный параметр превышен, то файл или значение загрузится как отдельный файл по тому же пути. Рекомендуемый размер не более 1048576 (1МБ). Не имеет особого смысла загружать файлы/значения в bolt архивы размером больше 32МБ. Такие файлы/значения должны сохраняться отдельно. (байты)
- **Умолчание:** обязательный параметр
- **Значения:** 1-536870912
- **Тип:** int64
- **Секция:** [server.name]

args
- **Описание:** если отключено, тогда query аргументы будут запрещены для GET запросов. Имеет смысл включить, если вы используете Vary заголовки на реверс прокси или версионность через query аргументы
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

getbolt
- **Описание:** если отключено, тогда будет запрещено скачивать напрямую bolt архивы
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

getcount
- **Описание:** если отключено, тогда будет запрещено получать суммарное количество файлов/значений (в том числе отдельных файлов) в директории.
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

getkeys
- **Описание:** если отключено, тогда будет запрещено получать имена файлов/ключей (в том числе отдельных файлов) в директории
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

nonunique
- **Описание:** если включено, тогда будет возможно загрузить файл с не уникальным именем в директорию, где уже есть bolt архив, и в этом bolt архиве есть файл/значение с тем же именем ключа, что и загружаемый отдельный файл. В случае если этот параметр выключен, то обратное все равно возможно, то есть возможно загрузить файл/значение именно в bolt архив, даже если уже есть отдельный файл в той же директории с тем же именем, что и имя ключа, загружаемого в bolt архив файла/значения
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]  

cctrl
- **Описание:** устанавливает заголовок Cache-Control
- **Умолчание:** обязательный параметр
- **Значения:** 0-2147483647
- **Тип:** int
- **Секция:** [server.name]

buffers options
- **Описание:** параметры буферов чтения/записи. Все буферы могут увеличены в несколько раз для сетей с 10-100 Gbit пропускной способностью. Каждый следующий буфер не может быть меньше или равен предыдущему. Требуется увеличивать при условии, что у вас действительно есть большие файлы. В данном примере установлены минимально возможные значения у всех буферов, кроме minbuffer, его минимально возможное значение равно 4096 байт. Для большиства задач этих параметров в стандартном конфигурацонном файле вполне достаточно
- **Умолчание:** обязательный параметр 
- **Тип:** int
- **Секция:** [global]

- minbuffer = 262144 # минимальный буфер памяти, при не превышении данного значения используется буфер еще более меньший 
- lowbuffer = 1048576 # малый буфер памяти, при превышении данного значения используется минимальный буфер памяти
- medbuffer = 67108864 # средний буфер памяти, при превышении данного значения используется малый буфер памяти
- bigbuffer = 536870912 # не совсем буфер памяти, при превышении данного значения используется средний буфер памяти

filemode
- **Описание:** права создания bolt архивов, файлов и виртуальных атрибутов в бинарном заголовке внутри значения в bolt архивах 
- **Умолчание:** обязательный параметр
- **Значения:** 0600-0666
- **Тип:** uint32
- **Секция:** [server.name]

dirmode
- **Описание:** права создания директорий 
- **Умолчание:** обязательный параметр
- **Значения:** 0700-0777
- **Тип:** uint32
- **Секция:** [server.name]

delbolt
- **Описание:** если включено, тогда будет разрешено удалять напрямую bolt архивы
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

deldir
- **Описание:** если включено, тогда wZD сервер будет удалять последнюю пустую директорию, при условии, что реально отсутствуют файлы, поддиректории и количество ключей в bolt архиве = 0. Но удаляется только текущая директория, рекурсивного обхода не реализовано в целях безопасности
- **Умолчание:** обязательный параметр
- **Значения:** true/false
- **Тип:** boolean
- **Секция:** [server.name]

Параметры wZA:
========

Секция [command line]
------------

- -bfilemode string
        --bfilemode=0640 - (0600-0666) права на bolt архивы при упаковке с uid/gid от текущего пользователя/группы (по умолчанию 0640)
- -delete
        --delete - включает режим удаления оригинальных регулярных файлов (с --pack) после упаковки или оригинальных bolt архивов (с --unpack) после распаковки
- -disablecompaction
        --disablecompaction - отключает отложенную компакцию bolt архивов после упаковки (с --overwrite)
- -disablereadintegrity
        --disablereadintegrity - отключает чтение контрольных сумм CRC из бинарного заголовка для регулярных файлов в bolt архивах
- -disablewriteintegrity
        --disablewriteintegrity - отключает запись контрольных сумм CRC в бинарный заголовок для регулярных файлов в bolt архивах
- -fmaxsize int
        --fmaxsize=1048576 - максимально допустимый размер регулярного файла для записи в bolt архивы, в противном случае пропускает файл, максимальное значение: 536870912 байта (по умолчанию 1048576)
- -help
        --help - выводит помощь
- -ignore
        --ignore - включает режим игнорирования всех ошибок при выполнении режима массовой упаковки/распаковки из списка (если потоков > 1, тогда режим игнорирования всегда включен для продолжения выполнения рабочих потоков)
- -ignore-not
        --ignore-not - включает режим игнорирования только тех файлов, которые не существуют/к которым в доступе отказано, действует при работе в режиме массовой упаковки/распаковки по списку
- -list string
        --list=/path/to/list.txt - упаковать/распаковать регулярные файлы из списка (с помощью --pack) или bolt архивы из списка (с помощью --unpack)
- -locktimeout int
        locktimeout=60 - максимальный таймаут для открытия bolt архива за 1 попытку, максимальное значение: 3600 (по умолчанию 60)
- -overwrite
        --overwrite - включает режим перезаписи регулярных файлов или файлов в bolt архивах при упаковке/распаковке
- -pack
        --pack - включает режим упаковки для регулярных файлов из списка (с --list) или одиночного регулярного файла (с --single=) в bolt архивы
- -progress
        --progress - включает режим индикатора выполнения (несовместим с --verbose)
- -single string
        --single=/path/to/file - упаковать/распаковать один регулярный файл (с --pack) или bolt архив (с --unpack)
- -threads int
        --threads=1 - параллельная массовая упаковка/распаковка (компакция (с --overwrite) однопоточная, для безопасности), максимальное значение: 256 (по умолчанию 1)
- -tmpdir string
        --tmpdir=/tmp/wza - временная директория для разделения списка файлов между потоками
- -trytimes int
        trytimes=45 - максимальное количество попыток взять виртуальную блокировку для bolt архива (по умолчанию sleep = 1 между попытками), (с --pack && --list=), максимальное значение: 1000 (по умолчанию 45)
- -unpack
        --unpack - включает режим распаковки bolt архивов из списка (--list=) или одиночного bolt архива (с --single=) в регулярные файлы
- -verbose
        --verbose - включает подробный режим (несовместим с --progress)
- -version
        --version - выводит версию
